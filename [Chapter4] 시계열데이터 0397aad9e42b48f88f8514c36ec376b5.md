# [Chapter4] 시계열데이터

생성일: 2021년 3월 24일 오후 11:12

## 1.1. 시계열 데이터란?

- 시간에 따라 값이 관측되는 데이터. 
일정한 시간 간격으로 출력된 데이터.
    - 금융 시계열 데이터로는 대표적으로 주가, 거래량 등이 있다.
    시계열 데이터는 일반적으로 i.i.d(identical independent distribution) 가 성립하지 않는다.
        - i.i.d : 확률변수가 여러 개 있을 때 (X1 , X2 , ... , Xn) 이들이 상호독립적이며, 모두 동일한 확률분포 f(x)를 가진다면 iid이다.독립 시행에 따른 각 요소의 확률이 동일한 경우.
        ex) 동전 던지기. 첫 번째 동전이 앞면이 나올 확률(x1), 두 번째 동전이 앞면이 나올 확률(x2) ...은 모두 1/2로 같다.
- = 추세-주기, 계절성, 잔차의 합(혹은 곱)
    - 추세(trend) : 장기적으로 증가 혹은 감소를 설명하는 부분
    - 계절성(seasonality) : 특정 기간(일별, 분기별, 10년 별 등)마다 나타나는 패턴을 설명하는 부분
    - 주기(cycle) : 계절성과 비슷하게 비슷한 패턴을 보이는 것을 설명하는 부분이나,
    계절성과는 다르게 고정된 빈도가 아니다.

        !
        <img src="https://raw.githubusercontent.com/Hongbi-K/jeguring.github.io/main/%5BChapter4%5D%20시계열데이터%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.30.15.png">(%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.30.15.png)

        호주의 월별 당뇨약 판매량과 원데이터

        !
        [https://raw.githubusercontent.com/Hongbi-K/jeguring.github.io/main/%5BChapter4%5D%20시계열데이터%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.30.15.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.30.53.png)

        당뇨병 치료약 판매량(Observed)

        ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.31.00.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.31.00.png)

        추세(Trend)

        ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.31.07.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.31.07.png)

        계절성(Seasonal)

        ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.31.15.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.31.15.png)

        잔차(Residual)

        → 추세와 계절성이 명확하게 나타남. 2000년의 당뇨병 약의 판매략 예측 가능

        → But, **명확한 추세와 계절성을 가지지 않는** 주식이나 금값 유가등은 어떻게 예측할 것인가???????

        ⇒ Time Seires Model을 통해!

## 1.2. 시계열 모델(Time series Model)이란?

시계열 데이터를 분석하는 방법은 크게 두 가지 접근법이 있다. 

- Explanatory models(혹은 Associative Model)
- Time Series Model : (예- ARIMA, Prophet, LSTM)
    - 혹은 두개를 혼합하기도...

[Explanatory Model vs Time Series Model(예: 호주의 월별 당뇨병약의 판매량)](https://www.notion.so/194fce8c091041a990a8d7bb504662f4)

### Stationary(정상성) vs Non-stationary(비정상성)

- Satationary(정상성)
    - 시간이 변해도 통계적 특성이 일정한 시계열이다. 
    → 즉, 시계열 데이터의 특성이 **시간에 의존하지 않는다.**
    - 통계적 특성이 일정한 정도에 따라 
    'Strongly Stationary(강정상)'과 'Weakly Stationary(약정상)'으로 구분된다.
    일반적으로 약정상 시계열 정도만 되어도 정상성을 띈다고 본다.
    - 평균, 분산, 왜도, 첨도, 특성 시차 간의 공분산 등 모든 통계적 특성이 동일하면 강정상;
    평균과 분산의 통계적 특성이 동일하면 약정상으로 구분한다.
    → 시간에 따른 평균과 분산, 특정 시차 간의 공분산이 **시간에 따라 변하지 않는 것**
- Non-stationary(비정상성)

    : 시간에 따라 통계적 특성이 변한다. 
      시계열 데이터가 non-satationary 하다면 평균, 분산, 공분산은 시간의 함수가 될 수 없다.

## 2. ARIMA(AutoRegressive Integrated Moving Average)

- **자기 회귀 모델(AR)**과 **이동 평균 모델(MA)**과 데이터의 정상성을 확보하기 위한 **차분(I)**을 합친 모델
- ARIMA모델은 AR , I, MA의 차수를 정해야 하는데 이는 **ARIMA(p, d, q)**로 나타낸다.
AR의 차수는 p, I의 차수는 d, MA의 차수는 q로 표시한다. 
ARIMA(1,1,0) 일 경우 AR(1)와 I(1)를 합친 모델이라는 의미이다.

### 2.1. 자기 회귀 모델 (AR)

- 현재의 데이터를 **과거의 데이터의 선형 결합**으로 설명한다.
오늘의 값은 **어제의 값 자체에 영향을 받는다.**
- 만약 계수가 양수이면 어제의 값이 큰 값이면 오늘의 값도 큰 값을 가지며,
음수이면 어제의 값이 큰 값이면 오늘의 값은 작은 값이 된다.

    ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.42.31.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.42.31.png)

$y_t$: $t$시점에서의 관측값
$y_{t-1}$ : ${t-1}$ 시점에서의 관측값
$c$ : 상수항
$φ$ : 자기 회귀 모델 계수
$εt$: 에러항, 백색 잡음

- 자기 회귀 모델은 **AR(p)로 표현하며, p는 차수**를 나타낸다.

![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.52.18.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.52.18.png)

그래프에서 볼 수 있듯이 **일정한 평균(c/(1-φ1))과 일정한 크기의 분산(화이트 노이즈의 분산)**의 값을 가진 정상 시계열임을 알 수 있다.

![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.46.54.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.46.54.png)

### 2.2. 이동 평균 모델(MA)

- 현재의 데이터를 **과거의 데이터의 오차 항의 선형 결합**으로 설명한다. 
오늘의 값은 **어제의 값의 오차 항에 영향을 받는다.**
- 계수가 양수이면, 어제의 값이 상승하는 추세이면, 오늘의 값도 상승하는 추세이다. 
반대로 음수이면, 어제의 값이 상승하는 추세이면, 오늘의 값은 하강한다.

    ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.48.54.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.48.54.png)

    $y_t$: $t$시점에서의 관측값
    $c$ : 상수항
    $φ$ : 자기 회귀 모델 계수
    $εt$: t 시점에서의 에러항, 백색 잡음
    $ε_{t-1}$:{t-1} 시점에서의 에러항, 백색 잡음

- 이동평균 모델은 **MA(q)로 표현하며, q는 차수**를 나타낸다.\]

    ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.56.31.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.56.31.png)

### 2.3. 차분(I)

- 그래프를 그려 확인해 본 바와 같이 AR과 MA 모델은 정상 시계열을 전제로 한 모델이다.
- 차분은 정상 시계열이 아닌 것을 정상화시키는 방법 중 하나이다.
- **1차 차분은 단순히 현재시간과 그 전 시간의 차이**이다. (즉 속도이다.)
예를 들어 추세가 있어 증가 혹은 감소가 있는 시계열은 정상적이지 않지만
그 증가 속도, 감소 속도가 일정하다면 
1차 차분을 통해서 정상화시킬 수 있다.

    ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.57.24.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.57.24.png)

- 2차 차분은 속도와 속도의 차이이므로 가속도로 생각해도 좋다.

    ![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.57.31.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.57.31.png)

### 2.4. ARIMA

정상성을 전제로 하는 모델이므로 정상성 확인

추세xxx

![%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.58.36.png](%5BChapter4%5D%20%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%200397aad9e42b48f88f8514c36ec376b5/_2021-03-24__11.58.36.png)

- 0을 중심으로 진동 운동을 하는 모습을 보이고 있지만 진폭(분산)은 일정해 보이지 않는다.
    - 정량적으로 **정상성**을 알 수 있는 방법 : [Augmented Dickey-Fuller(ADF)검정법](https://chukycheese.github.io/translation/statistics/augmented-dickey-fuller-test/) (단위근 검정)
    -
